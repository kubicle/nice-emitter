function EventEmitter(){this._listenersPerEventId={},debugLevel>0&&(this._maxCountPerListenerKey={})}function ListenerList(t,e){this.methods=null,this.objects=null,this.count=0,debugLevel>0&&(this.emitter=t,this.eventId=e,this.isEmitting=!1,this.counterMap={})}function throwOrConsole(t,e){if(debugLevel>=EventEmitter.DEBUG_THROW)throw new Error(t+e);console.error(t+e)}function getObjectClassname(t){if(!t)return DEFAULT_LISTENER;if("string"==typeof t)return t;var e=t.constructor;return e.name||e.toString().split(/ |\(/,2)[1]}function getAsText(t,e,i){return void 0===i||"function"==typeof i?getObjectClassname(t)+".on('"+e+"', fn)":getObjectClassname(t)+".on('"+e+"', fn, "+getObjectClassname(i)+")"}module.exports=EventEmitter,EventEmitter.NO_DEBUG=0,EventEmitter.DEBUG_ERROR=1,EventEmitter.DEBUG_THROW=2;var debugLevel=EventEmitter.DEBUG_THROW;EventEmitter.setDebugLevel=function(t){debugLevel=t},EventEmitter.prototype.declareEvent=function(t){if(void 0!==this._listenersPerEventId[t])return throwOrConsole("Event ID declared twice: ",getAsText(this,t));this._listenersPerEventId[t]=new ListenerList(this,t)},EventEmitter.prototype.emit=function(t,e,i,s){var n=this._listenersPerEventId[t];if(void 0===n)return throwOrConsole("Undeclared event ID for "+getObjectClassname(this)+": ",t),!1;switch(arguments.length){case 1:return n.emit0();case 2:return n.emit1(e);case 3:return n.emit2(e,i);case 4:return n.emit3(e,i,s);default:return n.emitN.apply(n,[].slice.call(arguments,1))}},EventEmitter.prototype.makeQuickEmitFunction=function(t){var e=this._listenersPerEventId[t];return void 0===e?throwOrConsole("Undeclared event ID for "+getObjectClassname(this)+": ",t):e},EventEmitter.prototype.listenerCount=function(t){var e=this._listenersPerEventId[t];return void 0===e?throwOrConsole("Undeclared event ID for "+getObjectClassname(this)+": ",t):e.count},EventEmitter.prototype.on=function(t,e,i){var s=this._listenersPerEventId[t];if(!s)return throwOrConsole("Invalid event ID: ",getAsText(this,t,i)),this;if(debugLevel>0){if("function"!=typeof e||"function"==typeof i)return throwOrConsole("Invalid parameters to emitter.on: '",t+"', "+typeof e+", "+getObjectClassname(i)),this;s._countListener(i||this,i)}return s._addListener(i||this,e),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(t,e){var i=this._listenersPerEventId[t];if(!i)return throwOrConsole("Invalid event ID: ",getAsText(this,t,e));if("function"==typeof e){var s=i._findMethod(e);-1!==s&&i._removeListener(s,null)}else{var n=i._findListener(e);if(-1!==n)i._removeListener(n,e);else if(debugLevel>0&&!e)return throwOrConsole("Invalid parameter to emitter.off: '",t+"', "+e)}},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.forgetListener=function(t){for(var e in this._listenersPerEventId)this.off(e,t)},EventEmitter.prototype.setListenerMaxCount=function(t,e){if(0!==debugLevel)return t>0&&e?void(this._maxCountPerListenerKey[getObjectClassname(e)]=t):throwOrConsole("Invalid parameters to emitter.setListenerMaxCount: ",t+", "+e)},EventEmitter.prototype.setMaxListeners=function(t){if(0!==debugLevel)return!(t>0)||arguments.length>1?throwOrConsole("Invalid parameters to emitter.setMaxListeners: ",t+(void 0!==arguments[1]?", "+arguments[1]:"")):void(this._maxCountPerListenerKey[DEFAULT_LISTENER]=t)},ListenerList.prototype._addListener=function(t,e){"function"==typeof this.methods?(this.count=2,this.methods=[this.methods,e],this.objects=[this.objects,t]):0===this.count?(this.count=1,this.methods=e,this.objects=t):(this.methods[this.count]=e,this.objects[this.count++]=t)},ListenerList.prototype._findListener=function(t){return"function"==typeof this.methods?this.objects===t?0:-1:null!==this.objects?this.objects.indexOf(t):-1},ListenerList.prototype._findMethod=function(t){return"function"==typeof this.methods?this.methods===t?0:-1:null!==this.methods?this.methods.indexOf(t):-1},ListenerList.prototype._removeListener=function(t,e){if(this.count--,"function"==typeof this.methods)this.methods=null,this.objects=null;else{for(var i=t;i<this.count;i++)this.methods[i]=this.methods[i+1],this.objects[i]=this.objects[i+1];this.methods[i]=null,this.objects[i]=null}if(debugLevel>0){var s=getObjectClassname(e);this.counterMap[s]--,this.isEmitting&&throwOrConsole("Removed listener during emit: ",getAsText(this.emitter,this.eventId,e))}},ListenerList.prototype._countListener=function(t,e){var i=getObjectClassname(e),s=(this.counterMap[i]||0)+1;s>(this.emitter._maxCountPerListenerKey[i]||1)&&throwOrConsole("Too many listeners: "+getAsText(this.emitter,this.eventId,e)+". ",e?"Use "+getObjectClassname(this.emitter)+".setListenerMaxCount(n, "+i+") with n >= "+s:"Use "+getObjectClassname(this.emitter)+".setMaxListeners(n) with n >= "+s+'. Even better: specify your listeners when calling "on"');this.counterMap[i]=s,s>=2&&this.count>=1&&t===e&&-1!==this._findListener(e)&&throwOrConsole("Listener listens twice: ",getAsText(this.emitter,this.eventId,e))},ListenerList.prototype.emit0=function(){if(0===this.count)return!1;if(debugLevel>0&&(this.isEmitting=!0),"function"==typeof this.methods)this.methods.call(this.objects);else for(var t=0;t<this.count;t++)this.methods[t].call(this.objects[t]);return debugLevel>0&&(this.isEmitting=!1),!0},ListenerList.prototype.emit1=function(t){if(0===this.count)return!1;if(debugLevel>0&&(this.isEmitting=!0),"function"==typeof this.methods)this.methods.call(this.objects,t);else for(var e=0;e<this.count;e++)this.methods[e].call(this.objects[e],t);return debugLevel>0&&(this.isEmitting=!1),!0},ListenerList.prototype.emit2=function(t,e){if(0===this.count)return!1;if(debugLevel>0&&(this.isEmitting=!0),"function"==typeof this.methods)this.methods.call(this.objects,t,e);else for(var i=0;i<this.count;i++)this.methods[i].call(this.objects[i],t,e);return debugLevel>0&&(this.isEmitting=!1),!0},ListenerList.prototype.emit3=function(t,e,i){if(0===this.count)return!1;if(debugLevel>0&&(this.isEmitting=!0),"function"==typeof this.methods)this.methods.call(this.objects,t,e,i);else for(var s=0;s<this.count;s++)this.methods[s].call(this.objects[s],t,e,i);return debugLevel>0&&(this.isEmitting=!1),!0},ListenerList.prototype.emitN=function(){if(0===this.count)return!1;if(debugLevel>0&&(this.isEmitting=!0),"function"==typeof this.methods)this.methods.apply(this.objects,arguments);else for(var t=0;t<this.count;t++)this.methods[t].apply(this.objects[t],arguments);return debugLevel>0&&(this.isEmitting=!1),!0};var DEFAULT_LISTENER="<default>";